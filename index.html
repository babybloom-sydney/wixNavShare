<!DOCTYPE html>
<html lang="en">
<head>
Â  <meta charset="UTF-8">
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  <title>Nanny Profile Preview</title>
Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
Â  <style>
Â  Â  body{background:#f0f2f5;font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;display:flex;flex-direction:column;align-items:center;padding:20px;margin:0;}
Â  Â  .copy-container{display:flex;gap:8px;margin-bottom:12px;}
Â  Â  /* This CSS applies to all buttons, including your new one */
Â  Â  .copy-btn,.share-btn{background:#1877F2;color:white;border:none;padding:10px 16px;font-size:14px;font-weight:600;border-radius:6px;cursor:pointer;box-shadow:0 1px 2px rgba(0,0,0,.1);transition:background .2s ease; text-decoration: none; /* Added for <a> tags */ display: inline-block; /* Added for <a> tags */}
Â  Â  .copy-btn:hover,.share-btn:hover{background:#1666d1;}
Â  Â  .copy-btn.copied,.share-btn.copied{background:#4B8BF4;}
    /* Added style for disabled button */
    .share-btn:disabled { background: #9dbdf2; cursor: not-allowed; }
Â  Â  .fb-post{width:500px;max-width:100%;border:1px solid #ddd;border-radius:8px;background:#fff;box-shadow:0 1px 2px rgba(0,0,0,.1);}
Â  Â  .fb-header{display:flex;align-items:center;padding:12px;}
Â  Â  .fb-header img{width:40px;height:40px;border-radius:50%;margin-right:10px;}
Â  Â  .fb-header .fb-user-name{font-weight:bold;font-size:14px;color:#050505;}
Â  Â  .fb-header .fb-time{font-size:12px;color:#65676b;}
Â  Â  .fb-content{padding:0 12px 12px;font-size:14px;line-height:1.45;color:#050505;}
Â  Â  .fb-content p{margin:0;word-break:break-word;display:inline;}
Â  Â  .fb-reactions-bar{display:flex;justify-content:space-between;align-items:center;padding:6px 12px 8px;border-top:1px solid #ddd;font-size:13px;line-height:1;}
Â  Â  .fb-reactions{display:inline-flex;align-items:center;gap:5px;}
Â  Â  .reaction-icons-img{width:38px;height:18px;vertical-align:-2px;image-rendering:crisp-edges;}
Â  Â  .fb-reactions span,.fb-comments-count{color:#65676b;font-weight:600;cursor:pointer;}
Â  Â  .fb-reactions span:hover,.fb-comments-count:hover{text-decoration:underline;}
Â  Â  .fb-footer{display:flex;justify-content:space-around;border-top:1px solid #ddd;padding:8px 0;font-size:14px;color:#65676b;}
Â  Â  .fb-footer div{cursor:pointer;padding:6px 0;text-align:center;flex:1;user-select:none;}
Â  Â  .fb-footer div:hover{background:#f2f2f2;border-radius:4px;}
Â  Â  .fb-link-preview{border:1px solid #ddd;border-radius:6px;margin:12px;overflow:hidden;background:#f8f9fa;}
Â  Â  .fb-link-preview img{width:100%;display:block;object-fit:cover;}
Â  Â  .fb-link-text{padding:8px;}
Â  Â  .fb-link-text .domain{font-size:11px;color:#65676b;margin-bottom:2px;}
Â  Â  .fb-link-text .title{font-weight:bold;font-size:14px;color:#050505;margin-bottom:2px;}
Â  Â  .fb-link-text .description{font-size:13px;color:#050505;}
Â  Â  #loader{text-align:center;margin:40px;font-size:16px;color:#666;}
Â  Â  .error{color:red;text-align:center;margin:40px;}
Â  </style>
</head>
<body>
<div id="loader">Loading your profile...</div>

<div class="copy-container" style="display:none;">
Â  <button class="copy-btn" id="copyBtn">Copy Post</button>
Â  <button class="share-btn" id="shareBtn">Share Profile</button>
  
  <a href="#" id="returnBtn" class="share-btn" 
     style="display: none; text-decoration: none;">
    Return To Profile
  </a>
</div>

<div class="fb-post" style="display:none;">
Â  Â  <div class="fb-header">
Â  Â  <img id="profilePic" src="" alt="Profile">
Â  Â  <div>
Â  Â  Â  <div class="fb-user-name" id="userName">Loading...</div>
Â  Â  Â  <div class="fb-time">Just now</div>
Â  Â  </div>
Â  </div>
Â  <div class="fb-content" id="postText"><p>Loading...</p></div>
Â  <div class="fb-link-preview">
Â  Â  <img id="previewImage" src="" alt="Preview">
Â  Â  <div class="fb-link-text">
Â  Â  Â  <div class="domain">BABYBLOOMSYDNEY.COM.AU</div>
Â  Â  Â  <div class="title" id="previewTitle">Loading...</div>
Â  Â  Â  <div class="description" id="previewDesc">Loading...</div>
Â  Â  </div>
Â  </div>
Â  <div class="fb-reactions-bar">
Â  Â  <div class="fb-reactions">
Â  Â  Â  <img src="https://drive.google.com/thumbnail?id=1fYJDK5-RDUYNw7smpK0TKKBxU4suCdq6&sz=w2000-h1050" class="reaction-icons-img" alt="Reactions">
Â  Â  Â  <span>12</span>
Â  Â  </div>
Â  Â  <div class="fb-comments-count">6 comments</div>
Â  </div>
Â  <div class="fb-footer">
Â  Â  <div>Like</div><div>Comment</div><div>Share</div>
Â  </div>
</div>

<script>
Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  const loader = document.getElementById('loader');
Â  Â  try {
Â  Â  Â  const urlParams = new URLSearchParams(window.location.search);
Â  Â  Â  const dataParam = urlParams.get('data');
Â  Â  Â  if (!dataParam) throw new Error('No data in URL');

Â  Â  Â  const base64Data = dataParam.replace(/-/g, '+').replace(/_/g, '/');
Â  Â  Â  const compressedData = atob(base64Data);
Â  Â  Â  const compressedArray = new Uint8Array(compressedData.length);
Â  Â  Â  for (let i = 0; i < compressedData.length; i++) {
Â  Â  Â  Â  compressedArray[i] = compressedData.charCodeAt(i);
Â  Â  Â  }
Â  Â  Â  const jsonString = pako.inflate(compressedArray, { to: 'string' });
Â  Â  Â  const data = JSON.parse(jsonString);

Â  Â  Â  if (!data.contactId) throw new Error('Invalid data');

Â  Â  Â  renderPreview(data);
Â  Â  } catch (err) {
Â  Â  Â  loader.innerHTML = `<div class="error">Error: ${err.message}</div>`;
Â  Â  }
Â  });

Â  function renderPreview(data) {
Â  Â  document.getElementById('loader').remove();
Â  Â  document.querySelector('.copy-container').style.display = 'flex';
Â  Â  document.querySelector('.fb-post').style.display = 'block';

    // Create the final data object, filling in defaults
    const profileData = {
      contactId: data.contactId,
      firstName: data.firstName || 'Nanny',
      suburb: data.suburb || 'Sydney',
      profilePicture: data.profilePicture || 'https://randomuser.me/api/portraits/women/44.jpg',
      nanny_ad: data.nanny_ad || data.profilePicture || '',
      bioNanny: data.bioNanny || '',
      shareUrl: `https://babybloomsydney.com.au/nanny/${data.contactId}`
    };

Â  Â  document.getElementById('profilePic').src = profileData.profilePicture;
Â  Â  document.getElementById('userName').textContent = profileData.firstName;
Â  Â  document.getElementById('previewImage').src = profileData.nanny_ad;
Â  Â  document.getElementById('previewTitle').textContent = `Experienced Nanny Available | ${profileData.suburb}`;
Â  Â  document.getElementById('previewDesc').textContent = `Hi, I'm ${profileData.firstName} and I'm now available to Nanny!`;

Â  Â  const bio = profileData.bioNanny.replace(/\n\n/g, '<br><br>').replace(/\n/g, '<br>');
Â  Â  document.getElementById('postText').innerHTML = `<p>${bio}</p>`;

Â  Â  // === ADD DYNAMIC OG TAGS ===
Â  Â  const head = document.head;
Â  Â  const ogTags = [
Â  Â  Â  { property: 'og:title', content: `ðŸ’« Experienced Nanny Available ðŸ’« | ${profileData.suburb}` },
Â  Â  Â  { property: 'og:description', content: `Hi, I'm ${profileData.firstName} and I'm now available to Nanny!` },
Â  Â  Â  { property: 'og:image', content: profileData.nanny_ad },
Â  Â  Â  { property: 'og:url', content: profileData.shareUrl },
Â  Â  Â  { property: 'og:type', content: 'profile' }
Â  Â  ];

Â  Â  ogTags.forEach(tag => {
Â  Â  Â  let meta = head.querySelector(`meta[property="${tag.property}"]`);
Â  Â  Â  if (!meta) {
Â  Â  Â  Â  meta = document.createElement('meta');
        // Use setAttribute for 'property' as it's not a direct DOM property
Â  Â  Â  Â  meta.setAttribute('property', tag.property); 
Â  Â  Â  Â  head.appendChild(meta);
Â  Â  Â  }
Â  Â  Â  meta.setAttribute('content', tag.content); // Use setAttribute for 'content'
Â  Â  });
Â  }

Â  // === COPY POST - CLEAN TEXT ONLY ===
  // This listener is now outside renderPreview, so it needs to read the text
Â  document.getElementById('copyBtn').addEventListener('click', async (e) => {
Â  Â  e.preventDefault();
Â  Â  const postEl = document.getElementById('postText');
Â  Â  // Clone the node to avoid modifying the live text
Â  Â  const clone = postEl.cloneNode(true);
Â  Â  // Replace <br> tags with newlines
Â  Â  clone.innerHTML = clone.innerHTML.replace(/<br\s*\/?>/gi, '\n');
Â  Â  // Get the text content, which now has newlines
Â  Â  let text = clone.textContent || "";
    // Trim each line
Â  Â  text = text.split('\n').map(l => l.trim()).join('\n');

Â  Â  let copied = false;
Â  Â  if (navigator.clipboard) {
Â  Â  Â  try { await navigator.clipboard.writeText(text); copied = true; } catch (e) { console.error('Clipboard write failed', e); }
Â  Â  }
Â  Â  if (!copied) {
Â  Â  Â  const ta = document.createElement('textarea');
Â  Â  Â  ta.value = text; ta.style.position = 'fixed'; ta.style.opacity = '0';
Â  Â  Â  document.body.appendChild(ta); ta.select();
Â  Â  Â  copied = document.execCommand('copy');
Â  Â  Â  document.body.removeChild(ta);
Â  Â  }

Â  Â  if (copied) {
Â  Â  Â  e.target.textContent = 'Post Copied';
Â  Â  Â  e.target.classList.add('copied');
Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  e.target.textContent = 'Copy Post';
Â  Â  Â  Â  e.target.classList.remove('copied');
Â  Â  Â  }, 1000);
Â  Â  }
Â  });

Â  // === SHARE PROFILE - THIS LOGIC IS UPDATED ===
Â  document.getElementById('shareBtn').addEventListener('click', async (e) => {
Â  Â  e.preventDefault();
    const shareBtn = e.target; // Get the share button itself

Â  Â  let nannyUrl = ''; // We'll get this from the data param
    let shareTitle = 'Nanny Profile';
    let shareText = 'Check out this nanny profile!';

Â  Â  // Re-decode the URL param to get the needed data
    // This is your original, working pattern
Â  Â  try {
Â  Â  Â  const urlParams = new URLSearchParams(window.location.search);
Â  Â  Â  const dataParam = urlParams.get('data');
Â  Â  Â  if (dataParam) {
Â  Â  Â  Â  const base64Data = dataParam.replace(/-/g, '+').replace(/_/g, '/');
Â  Â  Â  Â  const compressedData = atob(base64Data);
Â  Â  Â  Â  const compressedArray = new Uint8Array(compressedData.length);
Â  Â  Â  Â  for (let i = 0; i < compressedData.length; i++) {
Â  Â  Â  Â  Â  compressedArray[i] = compressedData.charCodeAt(i);
Â  Â  Â  Â  }
Â  Â  Â  Â  const jsonString = pako.inflate(compressedArray, { to: 'string' });
Â  Â  Â  Â  const data = JSON.parse(jsonString);
Â  Â  Â  Â  
          // Set all the data we need
          nannyUrl = `https://babybloomsydney.com.au/nanny/${data.contactId}`;
          shareTitle = `Experienced Nanny Available | ${data.suburb}`;
          shareText = `Hi, I'm ${data.firstName} and I'm now available to Nanny!`;
Â  Â  Â  }
Â  Â  } catch (e) {
      console.error('Failed to get data for sharing', e);
    }

Â  Â  const shareData = {
Â  Â  Â  title: shareTitle,
Â  Â  Â  text: shareText,
Â  Â  Â  url: nannyUrl
Â  Â  };

Â  Â  if (navigator.share) {
Â  Â  Â  try {
Â  Â  Â  Â  await navigator.share(shareData);
Â  Â  Â  Â  
          // --- THIS IS THE NEW LOGIC ---
          // 1. Update share button
Â  Â  Â  Â  shareBtn.textContent = 'Shared!';
Â  Â  Â  Â  shareBtn.classList.add('copied');
          shareBtn.disabled = true; // Disable it

          // 2. Get and configure the new button
          const returnBtn = document.getElementById('returnBtn');
          returnBtn.href = nannyUrl; // Set the correct URL
          returnBtn.style.display = 'inline-block'; // Show the button

Â  Â  Â  } catch (err) {
Â  Â  Â  Â  console.log('Share failed or was canceled', err);
Â  Â  Â  }
Â  Â  } else {
Â  Â  Â  // Fallback for desktop
Â  Â  Â  navigator.clipboard.writeText(nannyUrl).then(() => {
Â  Â  Â  Â  shareBtn.textContent = 'URL Copied!';
Â  Â  Â  Â  shareBtn.classList.add('copied');
Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  shareBtn.textContent = 'Share Profile';
Â  Â  Â  Â  Â  shareBtn.classList.remove('copied');
Â  Â  Â  Â  }, 1000);
Â  Â  Â  });
Â  Â  }
Â  });
</script>

</body>
</html>
